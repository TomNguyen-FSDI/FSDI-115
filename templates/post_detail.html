{% extends 'base.html' %}

{% block title %}{{ post.title }}{% endblock title %}
{% block content %} 
<div class="container col-6">
    <div class="btn-container" id="lg-btn-container">
        <div class="btn-group" role="group" aria-label="Basic example">
            <a type="button" class="btn btn-dark btn-spacing" href="{% url 'home' %}">Home</a>
            <button type="button" class="btn btn-dark btn-spacing">Trending</button>
            <a type="button" class="btn btn-dark btn-spacing"
            href="{% url 'community_list' %}">Communities</a>
        </div>
    </div>
</div>
<div class="d-flex justify-content-center">
<div class="post-detail rounded shadow">
    <h2 class="title-case" >{{ post.title }}</h2>
    <img src="{{ post.image.url }}" alt="" style="width: 80%">
    <p class="title-case text-muted"> TMT/{{ post.community }}  &middot; Posted by u/{{ post.author }}  &middot; {{ post.date }}</p>
    <p class="text-container">{{ post.body }}</p>
    <div class="car-footer">

        <form 
        action="{% url 'like_post' post.pk %}"
        method="post">
            {% csrf_token %}
        {% if user.is_authenticated %}
            {% if liked %}
            <button 
                type="submit" 
                name="post_id" 
                value="{{ post.id }}" 
                class="btn btn-danger btn-sm">
                Unlike
            </button> 
            {% else %}
            <button 
                type="submit" 
                name="post_id" 
                value="{{ post.id }}" 
                class="btn btn-primary btn-sm">
                Like 
            </button>
            {% endif %} 
        {% else %}
            <small><a type="button" class="btn btn-sm btn-outline-light text-dec-none" href="{% url 'login' %}">Login</a> to like or comment</small>
        {% endif %}

            <p> - {{ total_likes }} Likes</p>
        </form>

        <h6 class="text-muted title-case  border-bottom-utl mt-3">Comments</h6>

        {% if user.is_authenticated %}
        <a href="{% url 'add_comment' post.pk %}">Add Comment</a>
        {% else %}

        {% endif %}

        {% for comment in post.comments.all reversed %}
        <p>
            <span class="font-weight-bold">
                {{ comment.author }} &middot;
            </span>
            {{ comment }}
        </p>
        {% endfor %}
    </div>
    {% if user == post.author %}
    <div>
        <a href="{% url 'post_update' post.pk %}" class="btn btn-primary mt-3">+ Edit post</a>
        <a href="{% url 'post_delete' post.pk %}" class="btn btn-danger ms-3 mt-3">- Delete post</a>
        <a href="{% url 'home' %}" class="btn btn-dark ms-3 mt-3">Back</a>
    </div>
    {% else %}
    <!-- only let the author edit or delete post -->
    <!-- Send them back to home page -->
    <div class="btn-container">
        <a href="{% url 'home' %}" class="btn btn-primary mt-3">Back to posts</a>
    </div>
    {% endif %}
</div>
</div> <!-- display flex-->
{% endblock content %}