{% extends 'base.html' %}

{% block title %}{{ post.title }}{% endblock title %}
{% block content %} 
<div class="container col-6">
    <div class="btn-container" id="lg-btn-container">
        <div class="btn-group" role="group" aria-label="Basic example">
            <a type="button" class="btn btn-dark btn-spacing" href="{% url 'home' %}">Home</a>
            <button type="button" class="btn btn-dark btn-spacing">Trending</button>
            <a type="button" class="btn btn-dark btn-spacing"
            href="{% url 'community_list' %}">Communities</a>
        </div>
    </div>
</div>
<div class="d-flex justify-content-center">
<div class="post-detail rounded shadow">

    <div class="container">
        <div class="row">

          <div class="col">
            <a href="{% url 'home' %}" title="Back to posts"><i class="fas fa-arrow-left"></i></a>
          </div>

          <div class="col center-col">
            <h2 class="title-case" >{{ post.title }}</h2>
          </div>

          <div class="col">
            {% if user == post.author %}
            <div class="dropdown">
                <button 
                class="btn btn-secondary dropdown-toggle" 
                type="button" 
                id="dropdownMenuButton1" 
                data-bs-toggle="dropdown" 
                aria-expanded="false"
                title="Edit/Delete post">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li><a href="{% url 'post_update' post.pk %}" class="dropdown-item">Edit post</a></li>
                <li><a href="{% url 'post_delete' post.pk %}" class="dropdown-item">Delete post</a></li>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
        
        
        
    

    <img src="{{ post.image.url }}" alt="" style="width: 80%">
    <p class="title-case text-muted"> TMT/{{ post.community }}  &middot; Posted by u/{{ post.author }}  &middot; {{ post.date }}</p>
    <p class="text-container">{{ post.body }}</p>
    <div class="car-footer">

        <form 
        action="{% url 'like_post' post.pk %}"
        method="post"
        class="like-container">
            {% csrf_token %}
        {% if user.is_authenticated %}
            {% if liked %}
            <button 
                type="submit" 
                name="post_id" 
                value="{{ post.id }}" 
                class="thumbs-up">
                <i class="fas fa-thumbs-up"></i>
            </button> 
            {% else %}
            <button 
                type="submit" 
                name="post_id" 
                value="{{ post.id }}" 
                class="thumbs-up">
                <i class="far fa-thumbs-up"></i>
            </button>
            {% endif %} 
        {% else %}
            <small><a type="button" class="btn btn-sm btn-outline-light text-dec-none" href="{% url 'login' %}">Login</a> to like or comment</small>
        {% endif %}

            <p> - {{ total_likes }} Likes</p>
        </form>

        <h6 class="text-muted title-case  border-bottom-utl mt-3">Comments</h6>

        {% if user.is_authenticated %}
        
        <a class="btn btn-light comment-btn" href="{% url 'add_comment' post.pk %}">Add Comment</a>
       
        
        {% else %}

        {% endif %}

        {% for comment in post.comments.all reversed %}
        <div class="comments mb-3">
            <p class="">
                <span class="font-weight-bold">
                    u/{{ comment.author }} &middot; {{ comment.created_on }}
                </span>
            </br>
                <span>
                    {{ comment }}
                </span>
            </p> 
            {% if user == comment.author %}
            <div class="dropdown">
                <button 
                class="btn btn-secondary dropdown-toggle comment-dropdown" 
                type="button" 
                id="dropdownMenuButton1" 
                data-bs-toggle="dropdown" 
                aria-expanded="false"
                title="Edit/Delete post">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li class="comment-option"><a class="btn btn-light comment-btn" href="{% url 'comment_update' comment.pk post.id %}">Edit Comment</a></li>
                <li class="comment-option"><a class="btn btn-light comment-btn" href="{% url 'comment_delete' comment.pk post.id %}">delete Comment</a></li>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
</div> <!-- display flex-->
{% endblock content %}